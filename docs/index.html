<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>设备能力详尽评分</title>
  <style>
    body {
      margin: 20px;
      font-family: sans-serif;
      background: #f5f5f5;
      color: #333;
    }
    h1 { margin-bottom: .5em; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 1em;
    }
    th, td {
      padding: 8px 12px;
      border: 1px solid #ddd;
      text-align: left;
    }
    th { background: #f0f0f0; }
    #final-score {
      font-size: 1.2em;
      font-weight: bold;
      color: #0078d4;
    }
  </style>
</head>
<body>
  <h1>设备能力评分细则</h1>
  <table>
    <thead>
      <tr>
        <th>指标</th>
        <th>原始值</th>
        <th>权重系数</th>
        <th>子得分 = 原始值 × 权重</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>CPU 核心数</td>
        <td id="cpu-cores">–</td>
        <td id="cpu-weight">10</td>
        <td id="cpu-score">–</td>
      </tr>
      <tr>
        <td>设备类型权重</td>
        <td id="device-type">–</td>
        <td id="type-weight">–</td>
        <td id="type-score">–</td>
      </tr>
      <tr>
        <td>GPU Tier</td>
        <td id="gpu-tier">–</td>
        <td id="gpu-weight">5</td>
        <td id="gpu-score">–</td>
      </tr>
    </tbody>
  </table>

  <div id="final-score">综合得分：–</div>

  <script>
    (async () => {
      // --- 1. CPU 核心数 ---
      const cpuCores = navigator.hardwareConcurrency || 1;
      const cpuWeight = 10;
      const cpuScore  = cpuCores * cpuWeight;

      document.getElementById('cpu-cores').textContent = cpuCores;
      document.getElementById('cpu-weight').textContent = cpuWeight;
      document.getElementById('cpu-score').textContent  = cpuScore.toFixed(1);

      // --- 2. 设备类型及其权重 ---
      // 优先尝试 Client Hints
      let deviceType = 'desktop';
      if (navigator.userAgentData && typeof navigator.userAgentData.mobile === 'boolean') {
        deviceType = navigator.userAgentData.mobile ? 'mobile' : 'desktop';
      } else {
        const ua = navigator.userAgent;
        if (/Tablet|iPad/.test(ua))      deviceType = 'tablet';
        else if (/Mobile|Android|iPhone/.test(ua)) deviceType = 'mobile';
      }
      // 定义类型权重
      const typeWeights = { mobile: 1, tablet: 2, desktop: 3, server: 4 };
      const typeWeight  = typeWeights[deviceType] || 3;
      const typeScore   = typeWeight * 5;  // 统一乘 5

      document.getElementById('device-type').textContent = deviceType;
      document.getElementById('type-weight').textContent = typeWeight;
      document.getElementById('type-score').textContent  = typeScore.toFixed(1);

      // --- 3. GPU Tier ---
      // 这里不做实时测帧，仅示例固定 Tier
      // 如果需要实时测帧，请用 detect-gpu.getGPUTier()
      const gpuTier   = 3;  // 假设检测得 Tier 3
      const gpuWeight = 5;
      const gpuScore  = gpuTier * gpuWeight;

      document.getElementById('gpu-tier').textContent = gpuTier;
      document.getElementById('gpu-weight').textContent = gpuWeight;
      document.getElementById('gpu-score').textContent  = gpuScore.toFixed(1);

      // --- 4. 计算并显示综合得分 ---
      const finalScore = cpuScore + typeScore + gpuScore;
      document.getElementById('final-score').textContent = '综合得分：' + finalScore.toFixed(1);
    })();
  </script>
</body>
</html>
